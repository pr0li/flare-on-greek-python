#!/usr/bin/python

def calculateMagic(buffer):
	sum = 0xff
	accum = sum
	largo = len(buffer)
	lap = 0

	while True:
		bucle = 0x14
		if bucle > largo:
			bucle = largo
		largo = largo - bucle

		for i in range(bucle):
			sum = sum + buffer[i + (lap*0x14)]
			accum = accum + sum

		lap = lap + 1

		sum = (sum&0xff) + (sum / 0x100)
		accum = (accum&0xff) + (accum / 0x100)
		
		if largo <= 0:
			break

	 
	accum = (accum*0x100) + (accum&0xff00)
	sum = (sum&0xff) + (sum / 0x100)
	
	return accum | sum


def main():
	buffer = [0x33,0xE1,0xC4,0x99,0x11,0x06,0x81,0x16,0xF0,0x32,0x9F,0xC4,0x91,0x17,0x06,0x81,0x14,0xF0,0x06,0x81,0x15,0xF1,0xC4,0x91,0x1A,0x06,0x81,0x1B,0xE2,0x06,0x81,0x18,0xF2,0x06,0x81,0x19,0xF1,0x06,0x81,0x1E,0xF0,0xC4,0x99,0x1F,0xC4,0x91,0x1C,0x06,0x81,0x1D,0xE6,0x06,0x81,0x62,0xEF,0x06,0x81,0x63,0xF2,0x06,0x81,0x60,0xE3,0xC4,0x99,0x61,0x06,0x81,0x66,0xBC,0x06,0x81,0x67,0xE6,0x06,0x81,0x64,0xE8,0x06,0x81,0x65,0x9D,0x06,0x81,0x6A,0xF2,0xC4,0x99,0x6B,0x06,0x81,0x68,0xA9,0x06,0x81,0x69,0xEF,0x06,0x81,0x6E,0xEE,0x06,0x81,0x6F,0xAE,0x06,0x81,0x6C,0xE3,0x06,0x81,0x6D,0xEF,0x06,0x81,0x72,0xE9,0x06,0x81,0x73,0x7C]
	
	for brute in range(0x100):
		buff2 = []
		for elem in buffer:
			buff2.append(((elem ^ brute) + 0x22) & 0xff)
			
		res = calculateMagic(buff2)
		print str(hex(brute)) + ' > ' + hex(res).split('x')[-1]
		if res == 64350:
			print 'FOUND!!'
			break

if __name__ == "__main__":
	main()
